<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‡Ÿé¤Šå¹³è¡¡å¤§æŒ‘æˆ°ï¼šå¾®é‡å…ƒç´ å±æ©Ÿ (V34.0)</title>
    
    <style>
        /* ================================================= */
        /* CSS æ¨£å¼ï¼šæ ¸å¿ƒçµæ§‹èˆ‡ä½ˆå±€ (V34.0) */
        /* ================================================= */
        
        :root { font-size: 16px; }
        @media (max-width: 600px) { :root { font-size: 14px; } }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0.8rem;
            background-color: #2c3e50; 
            color: #ecf0f1;
            line-height: 1.5;
            overflow-y: auto; 
            /* ä¿æŒåº•éƒ¨é‚Šè·ï¼Œç‚ºå›ºå®šåœ¨åº•éƒ¨çš„æ“ä½œé¢æ¿é¨°å‡ºç©ºé–“ */
            padding-bottom: 200px; 
        }

        /* æ¨™é¡Œæ¨£å¼ä¸è®Šï¼Œä½†å…§å®¹æ›´æ–° */
        h1 { color: #f1c40f; text-align: center; font-size: 1.5rem; border-bottom: 2px solid #f1c40f; padding-bottom: 0.3rem; margin: 0 0 0.5rem 0; }
        h3 { font-size: 1rem; color: #3498db; margin: 0.4rem 0 0.2rem 0; border-bottom: 1px solid #34495e; padding-bottom: 0.1rem; }

        #game-container { display: flex; flex-direction: column; gap: 0.4rem; max-width: 900px; margin: 0 auto; }
        .panel { background-color: #34495e; padding: 0.7rem; border-radius: 6px; box-shadow: 0 0 8px rgba(0, 0, 0, 0.4); }

        /* ----------------------------------- */
        /* æ—¥èªŒå€å¡Š - æœ€æ–°è¨Šæ¯åœ¨ DOM é ‚éƒ¨ */
        /* ----------------------------------- */
        #game-output {
            max-height: 300px; 
            overflow-y: auto; 
            background-color: #2c3e50;
            border: 1px solid #3498db;
            padding: 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        #game-output p { margin: 0 0 0.2rem 0; white-space: pre-wrap; }

        /* ----------------------------------- */
        /* ç‹€æ…‹æ¢é¡è‰² */
        /* ----------------------------------- */
        .status-bar-container { background-color: #2c3e50; border-radius: 5px; overflow: hidden; margin-top: 2px; border: 1px solid #7f8c8d; }
        .status-bar { height: 10px; transition: width 0.5s ease-in-out, background-color 0.5s; }
        .red-bar { background-color: #e74c3c; } .orange-bar { background-color: #f39c12; } .gold-bar { background-color: #f1c40f; } .green-bar { background-color: #2ecc71; } 
        
        /* ----------------------------------- */
        /* æ–‡å­—ç‹€æ…‹é¡è‰² */
        /* ----------------------------------- */
        .red-status-text { color: #ff7f7f !important; } 
        .orange-status-text { color: #f39c12 !important; }
        .gold-status-text { color: #f1c40f !important; }
        .green-status-text { color: #2ecc71 !important; }

        /* ----------------------------------- */
        /* å›ºå®šåº•éƒ¨çš„æŒ‰éˆ•é¢æ¿ */
        /* ----------------------------------- */
        #action-panel {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 900px; z-index: 1000; 
            background-color: #34495e; border-radius: 0; padding: 0.7rem; 
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.5); 
        }
        
        .action-content { max-width: none; margin: 0; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }

        /* åŸºç¤æ²»ç™‚åŠŸèƒ½èªªæ˜å€å¡Š - ä¿æŒä¸è®Š */
        #action-panel #care-instruction {
            font-size: 0.85rem;
            color: #f1c40f; 
            background-color: #2c3e50; 
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0 10px 0; 
            font-weight: bold;
            border: 1px solid #e67e22; 
            text-align: center;
        }

        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        #action-panel button {
            width: auto; padding: 0.6rem; margin-bottom: 0; font-size: 0.85rem; font-weight: bold;
            color: #ffffff; border: none; border-radius: 5px; cursor: pointer; transition: all 0.2s ease;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3); background: linear-gradient(180deg, #3498db, #2980b9);
            box-shadow: 0 3px 0 #216694; 
        }
        #action-panel button:hover { opacity: 0.9; transform: translateY(-1px); }
        #action-panel button:active { box-shadow: 0 1px 0 #216694; transform: translateY(2px); }
        
        .base-care {
            background: linear-gradient(180deg, #2ecc71, #27ae60);
            box-shadow: 0 3px 0 #1e8449;
            grid-column: 1 / span 2; 
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        .base-care:active { box-shadow: 0 1px 0 #1e8449; }

        /* é«˜æ¿ƒç¸®ä¸¸ (é™·é˜±) - æŒ‰éˆ•æ–‡å­—ç¶­æŒ V32.0 ä¿®æ­£ */
        .toxic-trap { 
            background: linear-gradient(180deg, #e74c3c, #c0392b) !important; 
            box-shadow: 0 3px 0 #962d20 !important; 
            grid-column: 3 / span 1; 
        }
        .toxic-trap:active { box-shadow: 0 1px 0 #962d20 !important; }

        .deterioration {
            grid-column: 1 / span 3; 
            font-size: 1rem; padding: 0.8rem; margin-top: 4px;
            background: linear-gradient(180deg, #f1c40f, #e67e22) !important; color: #333 !important;
            box-shadow: 4px 4px 0 #c26514 !important;
        }
        .deterioration:active { box-shadow: 0 1px 0 #c26514 !important; transform: translateY(3px) !important; }
        
        #action-panel button:disabled { background: #95a5a6; box-shadow: none; cursor: not-allowed; opacity: 0.6; transform: none; text-shadow: none; }

        /* å…¶ä»–æ¬¡è¦æ¨£å¼ï¼ˆç‹€æ…‹æ¢ï¼‰ */
        #top-status-bar { background-color: #2980b9; padding: 0.4rem; border-radius: 5px; font-size: 0.85rem; display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        #status-display p { margin: 0.2rem 0 0.2rem 0; font-size: 0.9rem; }
        #status-display h4 { margin-top: 0.5rem !important; }

    </style>
</head>
<body>

    <div id="game-container">
        <h1>ç‡Ÿé¤Šå¹³è¡¡å¤§æŒ‘æˆ°ï¼šå¾®é‡å…ƒç´ å±æ©Ÿ (V34.0)</h1>

        <div id="top-status-bar" class="panel">
            </div>

        <div id="status-display" class="panel">
            <h3>ğŸ§¬ ç—…æ‚£çµ„ç¹”åŠŸèƒ½ç‹€æ…‹ (0-100)</h3>
            <p>æ­£åœ¨è¼‰å…¥ç©å®¶ç‹€æ…‹...</p>
        </div>

        <div id="log-panel" class="panel">
            <h3>ğŸ“œ è‡¨åºŠæ—¥èªŒèˆ‡ç³»çµ±è¨Šæ¯ (æœ€æ–°è¨Šæ¯åœ¨**é ‚éƒ¨**ï¼Œç„¡éœ€æ²å‹•)</h3>
            <div id="game-output">
                <p class="log-info">> ç³»çµ±ï¼šéŠæˆ²å·²å•Ÿå‹•ï¼Œè«‹é»æ“ŠæŒ‰éˆ•é–‹å§‹éŠæˆ²ã€‚</p>
            </div>
        </div>
    </div>

    <div id="action-panel" class="panel">
        <div class="action-content" style="max-width: none; margin: 0">
            <h3>ğŸ’Š è£œå……ä»‹å…¥è¡Œå‹•</h3>
            
            <p id="care-instruction">
                **åŸºç¤æ²»ç™‚èˆ‡æ”¯æŒ**ï¼šåƒ…åœ¨ **Aã€Cã€B1** ä¸‰ç¨®ç¶­ç”Ÿç´ ç‹€æ…‹**çš† â‰¥ 70** æ™‚ï¼Œæ‰èƒ½å®‰å…¨åœ°å°‡ç¸½é«”å¥åº· (OH) æå‡ **10** é»ã€‚
            </p>
            
            <div class="action-grid">
                <button onclick="useItem('ç‰›è‚', 15)">A: ç‰›è‚ (15 G)</button>
                <button onclick="useItem('æŸ‘æ©˜é¡æ°´æœ', 10)">C: æŸ‘æ©˜ (10 G)</button>
                <button onclick="useItem('ç³™ç±³', 10)">B1: ç³™ç±³ (10 G)</button>
                
                <button onclick="baseCareAndSupport(20)" class="base-care">ğŸ¥ åŸºç¤æ²»ç™‚èˆ‡æ”¯æŒ (20 G)</button> 
                
                <button onclick="useItem('ç¶œåˆç¶­ç”Ÿç´ é«˜åŠ‘é‡ä¸¸', 30)" class="toxic-trap">é«˜æ¿ƒç¸®ä¸¸ (A éé‡é¢¨éšª / 30 G)</button>
                
                <button onclick="nextRound()" class="deterioration">â­ï¸ é€²å…¥ä¸‹ä¸€å›åˆ (çµç®— Gold/ç‹€æ…‹æƒ¡åŒ–/æŒ‘æˆ°æª¢æŸ¥)</button>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // JavaScript æ ¸å¿ƒé‚è¼¯ (èˆ‡ V33.0 ç›¸åŒ)
        // =================================================================

        // --- é›£åº¦èª¿æ•´åƒæ•¸ (æ–°æ‰‹æ¨¡å¼) ---
        const EASY_MODE_GOLD_INCOME = 25;       
        const EASY_MODE_MAX_STATUS_LOSS = 10;   
        const EASY_MODE_CLINICAL_PENALTY = 5;   
        const EASY_MODE_TOXICITY_PENALTY = 10;  
        const EASY_MODE_SIRS_CHANCE = 0.15;     
        const EASY_MODE_MALABSORPTION_CHANCE = 0.10; 
        const EASY_MODE_WINNING_NUTRIENT_THRESHOLD = 60; 
        const MIN_STABLE_NUTRIENT_LEVEL = 70; 

        // -----------------------
        
        let playerStatus = {
            vitamin_A: 80, 
            vitamin_C: 95, 
            vitamin_B1: 70, 
            overall_health: 100,
            gold: 100, 
            round: 1, 
            max_rounds: 20 
        };

        let gameChallenges = {
            sir_active: false,
            sir_duration: 0, 
            malabsorption_active: false,
            malabsorption_duration: 0 
        };

        const micronutrientData = {
            vitamin_A: {
                name: "ç¶­ç”Ÿç´  A",
                deficiency_name: "å¤œç›²ç—‡",
                function_desc: "è¦–è¦ºã€å…ç–«ã€‚",
                min_safe: 70
            },
            vitamin_C: {
                name: "ç¶­ç”Ÿç´  C",
                deficiency_name: "å£è¡€ç—…",
                function_desc: "æŠ—æ°§åŒ–åŠ‘ã€‚",
                min_safe: 70
            },
            vitamin_B1: {
                name: "ç¶­ç”Ÿç´  B1",
                deficiency_name: "è…³æ°£ç—…",
                function_desc: "ç¢³æ°´ä»£è¬ã€‚",
                min_safe: 70
            }
        };

        const WINNING_HEALTH_THRESHOLD = 60;
        const WINNING_NUTRIENT_THRESHOLD = EASY_MODE_WINNING_NUTRIENT_THRESHOLD; 

        /**
         * è¼”åŠ©å‡½æ•¸ï¼šå°‡è¨Šæ¯è¼¸å‡ºåˆ° HTML éŠæˆ²æ—¥èªŒä¸­ï¼Œæœ€æ–°è¨Šæ¯åœ¨é ‚éƒ¨
         */
        function logToHTML(messages, type = 'log-info') {
            const outputDiv = document.getElementById('game-output');
            
            const elementsToPrepend = [];
            messages.forEach(msg => {
                const p = document.createElement('p');
                p.textContent = `> ${msg}`;
                p.classList.add(type);
                elementsToPrepend.push(p);
            });
            
            outputDiv.prepend(...elementsToPrepend);
        }

        // è¼”åŠ©å‡½æ•¸ï¼šæª¢æŸ¥æ‰€æœ‰æŒ‰éˆ•æ˜¯å¦ç¦ç”¨
        function disableAllActions() {
             document.querySelectorAll('#action-panel button').forEach(btn => btn.disabled = true);
        }

        // è¼”åŠ©å‡½æ•¸ï¼šæ›´æ–°æ‰€æœ‰é¡¯ç¤ºé¢æ¿
        function updateAllDisplays() {
            updateStatusDisplay();
            updateResourceChallengeDisplay();
        }

        // å‡½æ•¸ï¼šæ›´æ–°è³‡æºã€å›åˆã€ç›®æ¨™é¢æ¿ (ç•¥)
        function updateResourceChallengeDisplay() {
            const rcDiv = document.getElementById('top-status-bar');
            let html = `<div class="info-item">ğŸ’° Gold: ${playerStatus.gold}</div>`;
            html += `<div class="objective-item">ğŸ“… å›åˆ/ç›®æ¨™: ${playerStatus.round} / ${playerStatus.max_rounds}</div>`;
            
            let challengeHtml = '';
            if (gameChallenges.sir_active) {
                challengeHtml += `<div class="challenge-item">ğŸ”¥ SIRS (${gameChallenges.sir_duration}R)</div>`;
            }
            if (gameChallenges.malabsorption_active) {
                challengeHtml += `<div class="challenge-item">ğŸ¦  å¸æ”¶ä¸è‰¯ (${gameChallenges.malabsorption_duration}R)</div>`;
            }
            if (challengeHtml) {
                html += challengeHtml;
            } else {
                 html += `<div class="info-item" style="color:#2ecc71">âœ… è‡¨åºŠç©©å®š</div>`;
            }
            
            rcDiv.innerHTML = html;
        }

        /**
         * å‡½æ•¸ï¼šæ›´æ–°çµ„ç¹”åŠŸèƒ½ç‹€æ…‹é¡¯ç¤ºé¢æ¿ 
         */
        function updateStatusDisplay() {
            const statusDiv = document.getElementById('status-display');
            let html = '<h3>ğŸ§¬ ç—…æ‚£çµ„ç¹”åŠŸèƒ½ç‹€æ…‹ (0-100)</h3>';
            
            for (const nutrientKey in playerStatus) {
                if (nutrientKey === 'overall_health' || nutrientKey === 'gold' || nutrientKey === 'round' || nutrientKey === 'max_rounds') continue;
                
                let level = playerStatus[nutrientKey];
                let colorClass = 'green-bar';
                let textColorClass = 'green-status-text'; 
                const data = micronutrientData[nutrientKey];

                if (level < 50) { colorClass = 'red-bar'; textColorClass = 'red-status-text'; } 
                else if (level < 70) { colorClass = 'orange-bar'; textColorClass = 'orange-status-text'; } 
                else if (level < 90) { colorClass = 'gold-bar'; textColorClass = 'gold-status-text'; } 

                // æ‡‰ç”¨é¡è‰²é¡åˆ¥åˆ°ç‹€æ…‹æ–‡å­—ä¸Š
                html += `<p>
                    <strong class="${textColorClass}">${data.name}</strong>: 
                    <strong class="${textColorClass}">${level.toFixed(0)}/100</strong>
                    <div class="status-bar-container">
                        <div class="status-bar ${colorClass}" style="width: ${level}%;"></div>
                    </div>
                </p>`;
            }

            // ç¸½é«”å¥åº·ç‹€æ…‹æ¢ (OH)
            let overallColor = (playerStatus.overall_health > 50) ? 'green-bar' : 'red-bar';
            let overallTextColorClass = (overallColor.includes('red')) ? 'red-status-text' : 'green-status-text';
            
            html += `<h4 class="${overallTextColorClass}" style="font-size: 1rem;">
                ç¸½é«”å¥åº· (OH): <strong>${playerStatus.overall_health.toFixed(0)}/100</strong>
            </h4>
            <div class="status-bar-container">
                <div class="status-bar ${overallColor}" style="width: ${playerStatus.overall_health}%;"></div>
            </div>
            `;
            
            statusDiv.innerHTML = html;
        }


        /**
         * æ ¸å¿ƒæ©Ÿåˆ¶ 1ï¼šæª¢æŸ¥ä¸¦æ‡²ç½°é€²å…¥è‡¨åºŠç¼ºä¹çš„ç‹€æ…‹ (ç•¥)
         */
        function checkTissueFunctionalStatus() {
            let statusUpdates = [];
            
            if (gameChallenges.sir_active) {
                statusUpdates.push("ã€SIRS è­¦å ±ã€‘ç‚ç—‡åæ‡‰ä¸­ï¼Œç¶­ç”Ÿç´ è¡€æ¸…æ•¸å€¼å¯èƒ½å¤±çœŸï¼");
            }

            for (const nutrientKey in playerStatus) {
                if (nutrientKey === 'overall_health' || nutrientKey === 'gold' || nutrientKey === 'round' || nutrientKey === 'max_rounds') continue;
                
                const currentLevel = playerStatus[nutrientKey];
                const data = micronutrientData[nutrientKey];
                
                if (currentLevel < 50) {
                    playerStatus.overall_health -= EASY_MODE_CLINICAL_PENALTY; 
                    statusUpdates.push(`å±éšªï¼${data.name} ç¼ºä¹å°è‡´ ${data.deficiency_name}ã€‚OH -${EASY_MODE_CLINICAL_PENALTY}ã€‚`);
                }
            }
            
            if (playerStatus.overall_health <= 0) {
                logToHTML(["ã€éŠæˆ²å¤±æ•—ã€‘ ç—…æ‚£çµ„ç¹”åŠŸèƒ½å¾¹åº•å–ªå¤±ï¼Œç‡Ÿé¤Šç®¡ç†å¤±æ•—ã€‚"], 'log-error');
                disableAllActions();
                playerStatus.overall_health = 0; 
                updateAllDisplays();
                return;
            } else if (statusUpdates.length > 0) {
                 logToHTML(statusUpdates);
            }

            updateAllDisplays();
        }


        /**
         * æ ¸å¿ƒæ©Ÿåˆ¶ 2ï¼šé£Ÿç‰©è£œå……èˆ‡æ¯’æ€§é™·é˜± (ç•¥)
         */
        function useItem(item, cost) {
            let log = [];
            let nutrientToBoost;
            let baseGain = 15;
            
            if (playerStatus.overall_health <= 0 || playerStatus.round > playerStatus.max_rounds) return;

            if (playerStatus.gold < cost) {
                logToHTML([`ã€è³‡æºä¸è¶³ã€‘è³¼è²· ${item} éœ€è¦ ${cost} Gã€‚`], 'log-error');
                return;
            }
            
            playerStatus.gold -= cost;

            switch(item) {
                case "ç‰›è‚":
                    nutrientToBoost = "vitamin_A";
                    if (gameChallenges.malabsorption_active) {
                         baseGain = Math.floor(baseGain * 0.3); 
                         log.push("ã€å¸æ”¶ä¸è‰¯ã€‘ç¶­ç”Ÿç´  A å¸æ”¶æ•ˆç‡æ¥µä½ï¼");
                    }
                    break;
                case "æŸ‘æ©˜é¡æ°´æœ":
                    nutrientToBoost = "vitamin_C";
                    break;
                case "ç³™ç±³":
                    nutrientToBoost = "vitamin_B1";
                    break;
                case "ç¶œåˆç¶­ç”Ÿç´ é«˜åŠ‘é‡ä¸¸":
                    if (playerStatus.vitamin_A >= 90) {
                        logToHTML([`ã€æ€¥æ€§ä¸­æ¯’ã€‘ç¶­ç”Ÿç´  A éé‡ï¼OH -${EASY_MODE_TOXICITY_PENALTY}ï¼è«‹å‹¿é‡è¤‡ä½¿ç”¨é«˜åŠ‘é‡ä¸¸ï¼`], 'log-error');
                        playerStatus.overall_health -= EASY_MODE_TOXICITY_PENALTY;
                        checkTissueFunctionalStatus();
                        return; 
                    }
                    playerStatus.vitamin_A += baseGain / 2;
                    playerStatus.vitamin_C += baseGain / 2;
                    playerStatus.vitamin_B1 += baseGain / 2;
                    log.push("ä½¿ç”¨é«˜åŠ‘é‡è£œå……å“ï¼Œç¶­ç”Ÿç´  A/C/B1 å°å¹…æå‡ã€‚");
                    break;
            }

            if (nutrientToBoost && playerStatus[nutrientToBoost] !== undefined) {
                playerStatus[nutrientToBoost] += baseGain;
                if (playerStatus[nutrientToBoost] > 100) {
                    playerStatus[nutrientToBoost] = 100; 
                    log.push(`ä½¿ç”¨ã€${item}ã€‘ï¼Œ${micronutrientData[nutrientToBoost].name} å·²é”æœ€å¤§å„²å‚™é‡ã€‚`);
                } else {
                    log.push(`ä½¿ç”¨ã€${item}ã€‘ï¼ŒæˆåŠŸè£œå…… ${micronutrientData[nutrientToBoost].name}ï¼ç‹€æ…‹æå‡ ${baseGain} é»ã€‚`);
                }
            }
            
            logToHTML(log, 'log-success');
            checkTissueFunctionalStatus();
        }

        /**
         * æ ¸å¿ƒæ©Ÿåˆ¶ 4: åŸºç¤æ²»ç™‚èˆ‡æ”¯æŒ (OH æ¢å¾©æ©Ÿåˆ¶)
         */
        function baseCareAndSupport(cost = 20) {
            if (playerStatus.overall_health <= 0 || playerStatus.round > playerStatus.max_rounds) return;
            if (playerStatus.gold < cost) {
                logToHTML([`ã€è³‡æºä¸è¶³ã€‘åŸºç¤æ²»ç™‚éœ€è¦ ${cost} Gã€‚`], 'log-error');
                return;
            }
            
            playerStatus.gold -= cost;
            
            // æª¢æŸ¥ç—…æ‚£æ˜¯å¦ç©©å®š (æ‰€æœ‰ç¶­ç”Ÿç´ ç‹€æ…‹å¿…é ˆ >= 70)
            const isStable = playerStatus.vitamin_A >= MIN_STABLE_NUTRIENT_LEVEL && 
                             playerStatus.vitamin_C >= MIN_STABLE_NUTRIENT_LEVEL && 
                             playerStatus.vitamin_B1 >= MIN_STABLE_NUTRIENT_LEVEL;
            
            if (isStable) {
                const recoveryAmount = 10;
                playerStatus.overall_health += recoveryAmount;
                if (playerStatus.overall_health > 100) playerStatus.overall_health = 100;
                logToHTML([`ã€åŸºç¤æ²»ç™‚ã€‘ âœ… ç—…æ‚£ç‡Ÿé¤Šç©©å®š (A/C/B1 â‰¥ ${MIN_STABLE_NUTRIENT_LEVEL})ã€‚ç¸½é«”å¥åº·æ¢å¾© ${recoveryAmount} é»ã€‚`], 'log-success');
            } else {
                logToHTML([`ã€åŸºç¤æ²»ç™‚ã€‘âš ï¸ ç‡Ÿé¤Šç´ ä¸å‡è¡¡ (éœ€ A/C/B1 çš† â‰¥ ${MIN_STABLE_NUTRIENT_LEVEL})ã€‚OH ç„¡æ³•æ”¹å–„ï¼Œé‡‘å¹£å·²èŠ±è²»ã€‚`], 'log-warning');
            }
            
            updateAllDisplays();
            checkTissueFunctionalStatus(); 
        }
        
        /**
         * éŠæˆ²ç›®æ¨™ï¼šæª¢æŸ¥å‹åˆ©æ¢ä»¶ (ç•¥)
         */
        function checkWinCondition() {
            if (playerStatus.round <= playerStatus.max_rounds) return;

            logToHTML(["\n--- ğŸ† æœ€çµ‚ç‡Ÿé¤Šç®¡ç†è©•ä¼°å ±å‘Š ---"], 'log-round');
            
            const isHealthOK = playerStatus.overall_health >= WINNING_HEALTH_THRESHOLD;
            let isNutrientOK = true;
            let finalScore = playerStatus.overall_health;

            for (const key in micronutrientData) {
                if (playerStatus[key] < WINNING_NUTRIENT_THRESHOLD) {
                    isNutrientOK = false;
                    logToHTML([`[è­¦å‘Š] ${micronutrientData[key].name} ç‹€æ…‹ (${playerStatus[key].toFixed(0)}) ä½æ–¼æœ€çµ‚è¦æ±‚ (${WINNING_NUTRIENT_THRESHOLD})ï¼`], 'log-warning');
                    finalScore -= 20; 
                } else {
                    finalScore += 5; 
                }
            }
            
            if (isHealthOK && isNutrientOK) {
                logToHTML([
                    "ğŸ‰ğŸ‰ğŸ‰ **æ­å–œï¼æ‚¨æˆåŠŸå®Œæˆ 20 å›åˆçš„ç®¡ç†ï¼** ğŸ‰ğŸ‰ğŸ‰",
                    `æœ€çµ‚ç¸½è©•åˆ†: ${finalScore + playerStatus.gold/2}ã€‚`,
                    "ç—…æ‚£å·²é”åˆ°è‡¨åºŠç©©å®šèˆ‡æœ€ä½³çµ„ç¹”ç‹€æ…‹ï¼"
                ], 'log-success');
            } else {
                logToHTML([
                    "âš ï¸ **è©•ä¼°çµæœï¼šç®¡ç†ä»æœ‰é¢¨éšªã€‚**",
                    `ç¸½é«”å¥åº·: ${playerStatus.overall_health.toFixed(0)}/${WINNING_HEALTH_THRESHOLD}ã€‚`,
                    "æœªèƒ½é”æˆæœ€çµ‚ç›®æ¨™ï¼Œä»éœ€ç¹¼çºŒè§€å¯Ÿèˆ‡èª¿æ•´ã€‚"
                ], 'log-error');
            }

            disableAllActions();
        }

        /**
         * æ ¸å¿ƒæ©Ÿåˆ¶ 3ï¼šé€²å…¥ä¸‹ä¸€å›åˆ (æ™‚é–“æµé€) (ç•¥)
         */
        function nextRound() {
            if (playerStatus.overall_health <= 0) return;
            if (playerStatus.round > playerStatus.max_rounds) {
                checkWinCondition();
                return;
            }

            playerStatus.round++;
            logToHTML([`\n--- é€²å…¥ç¬¬ ${playerStatus.round} å›åˆ/æœˆ ---`], 'log-round');
            
            // 1. Gold æ”¶å…¥ (å›åˆçå‹µ)
            playerStatus.gold += EASY_MODE_GOLD_INCOME + Math.floor(Math.random() * 5); 
            logToHTML([`ã€å›åˆçµç®—ã€‘ç²å¾— ${EASY_MODE_GOLD_INCOME + Math.floor(Math.random() * 5)} Gã€‚`], 'log-info');

            // 2. ç‡Ÿé¤Šç´ ç‹€æ…‹æƒ¡åŒ– (åŸºç¤æ¶ˆè€—)
            for (const key in playerStatus) {
                if (key !== 'overall_health' && key !== 'gold' && key !== 'round' && key !== 'max_rounds') {
                    const reduction = Math.floor(Math.random() * (EASY_MODE_MAX_STATUS_LOSS - 3 + 1)) + 3; 
                    playerStatus[key] -= reduction;
                    if (playerStatus[key] < 0) playerStatus[key] = 0;
                }
            }
            logToHTML(["ã€æ™‚é–“æµé€ã€‘ç—…æ‚£åŸºç¤ä»£è¬èˆ‡æ¶ˆè€—ï¼Œç‡Ÿé¤Šç´ ç‹€æ…‹æƒ¡åŒ–ï¼"], 'log-warning');

            // 3. æŒ‘æˆ°ç‹€æ…‹æª¢æŸ¥èˆ‡æŒçºŒæ™‚é–“æ¸›å°‘
            let challengeUpdate = [];
            if (gameChallenges.sir_duration > 0) {
                gameChallenges.sir_duration--;
                if (gameChallenges.sir_duration === 0) {
                    gameChallenges.sir_active = false;
                    challengeUpdate.push("ã€æŒ‘æˆ°è§£é™¤ã€‘SIRS çµæŸã€‚");
                }
            }
            if (gameChallenges.malabsorption_duration > 0) {
                gameChallenges.malabsorption_duration--;
                if (gameChallenges.malabsorption_duration === 0) {
                    gameChallenges.malabsorption_active = false;
                    challengeUpdate.push("ã€æŒ‘æˆ°è§£é™¤ã€‘å¸æ”¶ä¸è‰¯ç—‡ç‹€çµæŸã€‚");
                }
            }
            if (challengeUpdate.length > 0) logToHTML(challengeUpdate, 'log-success');


            // 4. éš¨æ©ŸæŒ‘æˆ°è§¸ç™¼ (æ©Ÿç‡é™ä½)
            if (Math.random() < EASY_MODE_SIRS_CHANCE && !gameChallenges.sir_active && playerStatus.round < playerStatus.max_rounds - 5) { 
                gameChallenges.sir_active = true;
                gameChallenges.sir_duration = 3; 
                logToHTML(["ã€çªç™¼äº‹ä»¶ã€‘ç—…æ‚£æ„ŸæŸ“ï¼SIRS æ¿€æ´»ï¼æ•¸æ“šå¤±çœŸï¼"], 'log-error');
            }
            if (Math.random() < EASY_MODE_MALABSORPTION_CHANCE && !gameChallenges.malabsorption_active && playerStatus.round < playerStatus.max_rounds - 5) { 
                gameChallenges.malabsorption_active = true;
                gameChallenges.malabsorption_duration = 4; 
                logToHTML(["ã€çªç™¼äº‹ä»¶ã€‘è…¸é“ä¸é©ï¼å¸æ”¶ä¸è‰¯ï¼è£œå……æ•ˆç‡é™ä½ï¼"], 'log-error');
            }

            // 5. æª¢æŸ¥ç‹€æ…‹èˆ‡å‹åˆ©æ¢ä»¶
            checkTissueFunctionalStatus();
            if (playerStatus.round > playerStatus.max_rounds) {
                 checkWinCondition();
            }
        }

        // =================================================================
        // éŠæˆ²åˆå§‹åŒ–
        // =================================================================

        document.addEventListener('DOMContentLoaded', () => {
            logToHTML(["**ç¨‹å¼ç¢¼å·²æˆåŠŸè¼‰å…¥ï¼è«‹é»æ“ŠæŒ‰éˆ•é–‹å§‹éŠæˆ²ã€‚**"], 'log-success'); 
            checkTissueFunctionalStatus();
        });

    </script>
</body>
</html>