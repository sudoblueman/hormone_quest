<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…§åˆ†æ³Œç‰¹å·¥éšŠï¼šè·çˆ¾è’™å¤§ä½œæˆ° - æœ€çµ‚ç‰ˆ</title>
    <style>
        /* CSS æ¨£å¼ï¼šæ‰‹æ©Ÿé–±è®€å„ªåŒ– (ä¿æŒä¸è®Š) */
        body {
            font-family: 'Helvetica Neue', 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background-color: #f8f8fa;
            color: #333;
            margin: 0;
            padding: 20px;
            font-size: 16px; 
            line-height: 1.6; 
        }
        #game-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
        }
        h1 {
            color: #0056b3;
            text-align: center;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
            margin-top: 0;
            font-size: 1.8em; 
        }
        h2 {
            color: #3a75c4;
            margin-top: 25px;
            border-left: 5px solid #3a75c4;
            padding-left: 12px;
            font-size: 1.4em;
        }
        #monitor p {
            font-size: 1.1em;
            margin: 10px 0;
            padding: 8px;
            border-bottom: 1px dotted #ccc;
        }
        #monitor span {
            font-weight: bold;
            color: #dc3545; 
            padding: 0 8px;
            border-radius: 4px;
            transition: color 0.5s; 
        }
        #target-standards {
            margin-top: 20px;
            border: 1px dashed #3a75c4;
            padding: 15px;
            border-radius: 8px;
            background-color: #f0f7ff;
        }
        #target-standards ul {
            list-style: disc;
            padding-left: 20px;
            margin: 10px 0 0 0;
            font-size: 1em;
        }
        #target-standards li {
            margin-bottom: 5px;
        }
        #target-standards span {
            font-weight: bold;
            color: #28a745; 
        }
        #control-panel button {
            display: block; 
            width: 100%; 
            padding: 15px;
            margin: 15px 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em; 
            font-weight: bold;
            transition: background-color 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #release-insulin {
            background-color: #5cb85c; 
            color: white;
        }
        #synthesize-cortisol {
            background-color: #f0ad4e; 
            color: #333;
        }
        #apply-feedback {
            background-color: #007bff; 
            color: white;
        }
        #apply-feedback:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }
        #game-message {
            margin-top: 30px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #cce5ff;
        }
        .action-log {
            font-size: 0.95em;
            margin: 7px 0;
            padding-bottom: 4px;
            border-bottom: 1px dotted #a0c4ff;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
                font-size: 14px; 
            }
            #game-container {
                padding: 20px 15px;
                border-radius: 0; 
                box-shadow: none;
            }
            #control-panel button {
                font-size: 1.0em;
                padding: 12px;
            }
        }
    </style>
</head>
<body>

<div id="game-container">
    <h1>å…§åˆ†æ³Œç‰¹å·¥éšŠï¼šè·çˆ¾è’™å¤§ä½œæˆ°</h1>
    <p>**éŠæˆ²ç›®æ¨™ï¼š** **å°‡æ‰€æœ‰ç”Ÿç†æŒ‡æ¨™ç¶­æŒåœ¨ä¸‹æ–¹ã€Œå¥åº·æ¨™æº–ç¯„åœã€å…§ 20 ç§’ä»¥é”æˆå‹åˆ©ï¼**</p>

    <div id="monitor">
        <h2>ğŸ“Š èº«é«”æ†å®šç‹€æ…‹ (å³æ™‚æ•¸æ“š)</h2>
        <p>è¡€ç³–æ¿ƒåº¦ï¼š<span id="blood-glucose">100</span> mg/dL</p>
        <p>å£“åŠ›æŒ‡æ•¸ï¼š<span id="stress-level">0</span></p>
        <p>çš®è³ªé†‡ (ä¸‹æ¸¸è·çˆ¾è’™)ï¼š<span id="cortisol-level">10</span> Î¼g/dL</p>
        <p>ä¿ƒè…ä¸Šè…ºçš®è³ªç´  (ACTH, ä¸Šæ¸¸è·çˆ¾è’™)ï¼š<span id="acth-level">15</span> pg/mL</p>
        <p style="font-weight: bold; color: #007bff;">
            å‹åˆ©å€’æ•¸ï¼š<span id="success-progress" style="color: #28a745;">0</span> / 20 ç§’
        </p>
    </div>

    <div id="target-standards">
        <h2>ğŸ¯ å‹åˆ©ç›®æ¨™ï¼šå¥åº·æ¨™æº–ç¯„åœ</h2>
        <ul>
            <li>è¡€ç³–æ¿ƒåº¦ (BG)ï¼š<span id="target-bg"></span> mg/dL</li>
            <li>å£“åŠ›æŒ‡æ•¸ (Stress)ï¼š<span id="target-stress"></span></li>
            <li>çš®è³ªé†‡ (Cortisol)ï¼š<span id="target-cortisol"></span> Î¼g/dL</li>
            <li>ACTHï¼š<span id="target-acth"></span> pg/mL</li>
        </ul>
    </div>

    <div id="control-panel">
        <h2>ğŸ› ï¸ è…ºé«”æŒ‡æ®ä¸­å¿ƒ (ç©å®¶è¡Œå‹•)</h2>
        <button id="release-insulin">èƒ°è‡Ÿï¼šé‡‹æ”¾èƒ°å³¶ç´ ç‰¹å·¥ (å¤šè‚½é¡ - å¿«é€Ÿä½œç”¨)</button>
        <button id="synthesize-cortisol">è…ä¸Šè…ºï¼šåˆæˆçš®è³ªé†‡ç‰¹å·¥ (é¡å›ºé†‡ - é•·æ•ˆèª¿æ§)</button>
        <button id="apply-feedback" disabled>è² å›é¥‹ï¼šæŠ‘åˆ¶ACTH (HPAè»¸)</button>
    </div>

    <div id="game-message"></div>
</div>

<script>
// ** éŠæˆ²æ ¸å¿ƒé‚è¼¯ (JavaScript) - å‡ç³–ç´ è‡ªå‹•æ•‘æ´ç‰ˆ **

// 1. éŠæˆ²ç‹€æ…‹èˆ‡å¸¸é‡å®šç¾©
const GameState = {
    bloodGlucose: 100, 
    stressLevel: 0,    
    TIME_TICK_MS: 1000, 
    GLUCOSE_EFFECT_RATE: 30, 
    CORTISOL_CRITICAL_LEVEL: 18, 
    successCounter: 0, 
    SUCCESS_TARGET: 20, 
    
    // ç¬¦åˆæ­£å¸¸äººé«”ç”Ÿç†æ¨™æº–çš„å‹åˆ©ç›®æ¨™ç¯„åœ
    BG_MIN: 70, 
    BG_MAX: 130, 
    STRESS_MAX: 20, 
    CORTISOL_MAX: 20, 
    ACTH_MAX: 25, 
};

// 2. è·çˆ¾è’™ç³»çµ±é¡åˆ¥ (ç²¾ç¢ºæŒ‡æ•¸è¡°æ¸›)
class HormoneAgent {
    constructor(initialLevel, halfLifeInTicks) {
        this.level = initialLevel;
        this.halfLife = halfLifeInTicks; 
    }
    decay() {
        if (this.level > 0) {
            const decayFactor = Math.pow(0.5, 1 / this.halfLife);
            this.level *= decayFactor;
            this.level = Math.max(5, this.level); 
        }
    }
}

const ACTH_AGENT = new HormoneAgent(15, 10); 
const CORTISOL_AGENT = new HormoneAgent(10, 60); 

// 3. å‡½æ•¸ï¼šåˆå§‹åŒ–é¡¯ç¤ºå‹åˆ©æ¨™æº–
function initializeTargetDisplay() {
    document.getElementById('target-bg').innerText = `${GameState.BG_MIN} ~ ${GameState.BG_MAX}`;
    document.getElementById('target-stress').innerText = `< ${GameState.STRESS_MAX}`;
    document.getElementById('target-cortisol').innerText = `< ${GameState.CORTISOL_MAX}`;
    document.getElementById('target-acth').innerText = `< ${GameState.ACTH_MAX}`;
}

// 4. éŠæˆ²å‡½æ•¸ï¼šç•Œé¢æ›´æ–°èˆ‡è¨Šæ¯é¡¯ç¤º

function updateDisplay() {
    GameState.acthLevel = ACTH_AGENT.level;
    GameState.cortisolLevel = CORTISOL_AGENT.level;
    
    document.getElementById('blood-glucose').innerText = GameState.bloodGlucose.toFixed(1);
    document.getElementById('stress-level').innerText = GameState.stressLevel.toFixed(1);
    document.getElementById('cortisol-level').innerText = GameState.cortisolLevel.toFixed(1);
    document.getElementById('acth-level').innerText = GameState.acthLevel.toFixed(1);
    document.getElementById('success-progress').innerText = GameState.successCounter;

    // æ ¹æ“šæ•¸å€¼æ”¹è®Šé¡è‰²è­¦ç¤º
    const bgSpan = document.getElementById('blood-glucose');
    if (GameState.bloodGlucose > 180 || GameState.bloodGlucose < 60) {
        bgSpan.style.color = '#dc3545'; 
    } else if (GameState.bloodGlucose > 120 || GameState.bloodGlucose < 70) {
        bgSpan.style.color = '#ffc107'; 
    } else {
        bgSpan.style.color = '#28a745'; 
    }

    const feedbackButton = document.getElementById('apply-feedback');
    if (GameState.cortisolLevel > GameState.CORTISOL_CRITICAL_LEVEL) {
        feedbackButton.disabled = false;
        feedbackButton.textContent = `è² å›é¥‹ï¼šå•Ÿå‹•ï¼æŠ‘åˆ¶è…¦å‚é«”ACTH (çš®è³ªé†‡ > ${GameState.CORTISOL_CRITICAL_LEVEL.toFixed(1)} Î¼g/dL)`;
    } else {
        feedbackButton.disabled = true;
        feedbackButton.textContent = `è² å›é¥‹ï¼šéœ€çš®è³ªé†‡ > ${GameState.CORTISOL_CRITICAL_LEVEL.toFixed(1)} Î¼g/dL`;
    }
}

function displayMessage(msg) {
    const msgElement = document.getElementById('game-message');
    const newMsg = document.createElement('p');
    newMsg.className = 'action-log';
    newMsg.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
    msgElement.prepend(newMsg);
    while (msgElement.children.length > 8) {
        msgElement.removeChild(msgElement.lastChild);
    }
}


// 5. ç©å®¶æ“ä½œå‡½æ•¸ (ä¿æŒä¸è®Š)

document.getElementById('release-insulin').onclick = () => {
    if (GameState.bloodGlucose < 120) {
        displayMessage("âš ï¸ è¡€ç³–å·²æ­£å¸¸æˆ–åä½ã€‚éåº¦åˆ†æ³Œèƒ°å³¶ç´ å°‡å°è‡´ä½è¡€ç³–ï¼");
        GameState.bloodGlucose = Math.max(50, GameState.bloodGlucose - 5); 
        return;
    }
    
    const amount = GameState.GLUCOSE_EFFECT_RATE;
    GameState.bloodGlucose = Math.max(50, GameState.bloodGlucose - amount);
    displayMessage(`âœ… èƒ°å³¶ç´ ç‰¹å·¥ (å¤šè‚½é¡) ç¶å®šç´°èƒè¡¨é¢ ENZCRï¼Œè¡€ç³–å¿«é€Ÿä¸‹é™ ${amount} å–®ä½ã€‚`);
};

document.getElementById('synthesize-cortisol').onclick = () => {
    if (CORTISOL_AGENT.level > 40) {
         displayMessage("âŒ çš®è³ªé†‡å·²é”å±éšªé«˜å€¼ï¼è«‹å…ˆå•Ÿå‹•è² å›é¥‹æ©Ÿåˆ¶ã€‚");
         return;
    }
    
    CORTISOL_AGENT.level += 7;
    displayMessage("âœ… è…ä¸Šè…ºåˆæˆçš®è³ªé†‡ (é¡å›ºé†‡)ã€‚é€™å°‡é•·æœŸèª¿æ§ä»£è¬ä¸¦ç·©è§£å£“åŠ›ï¼Œä½†éœ€è¦æ™‚é–“ã€‚");
};

document.getElementById('apply-feedback').onclick = () => {
    if (CORTISOL_AGENT.level > GameState.CORTISOL_CRITICAL_LEVEL) {
        ACTH_AGENT.level = Math.max(5, ACTH_AGENT.level - 15); 
        CORTISOL_AGENT.level -= 5; 
        displayMessage(`ğŸ”¥ è² å›é¥‹æˆåŠŸï¼é«˜æ¿ƒåº¦çš®è³ªé†‡æŠ‘åˆ¶è…¦å‚é«” ACTH åˆ†æ³Œï¼Œå£“åŠ›è»¸ç·šæ¢å¾©å¹³è¡¡ã€‚`);
    } else {
        displayMessage("âš ï¸ çš®è³ªé†‡æ¿ƒåº¦ä¸è¶³ä»¥å•Ÿå‹•æœ‰æ•ˆçš„è² å›é¥‹ï¼è«‹ç­‰å¾…å…¶ç´¯ç©ã€‚");
    }
};

// 6. éŠæˆ²ä¸»å¾ªç’°èˆ‡ç‹€æ…‹æª¢æŸ¥

function handleHormoneDecay() {
    ACTH_AGENT.decay();
    CORTISOL_AGENT.decay();
}

function handleInteractions() {
    CORTISOL_AGENT.level += (ACTH_AGENT.level * 0.1);
    
    if (GameState.stressLevel > 10) {
        ACTH_AGENT.level += 1.0;
        GameState.stressLevel -= 1; 
    }
    
    // ***** åŸºç¤ä»£è¬æ¶ˆè€—å„ªåŒ– *****
    // é™ä½åŸºç¤æ¶ˆè€—ï¼Œæ¸›å°‘è¡€ç³–ä¸‹è·Œå£“åŠ›
    GameState.bloodGlucose = Math.max(50, GameState.bloodGlucose - 1.0); 

    // ***** å‡ç³–ç´  (Glucagon) è‡ªå‹•æ•‘æ´æ©Ÿåˆ¶ *****
    if (GameState.bloodGlucose < 80) {
        // ç•¶è¡€ç³–ä½æ–¼ 80 æ™‚ï¼Œè‡ªå‹•æå‡è¡€ç³–ï¼Œæ¨¡æ“¬å‡ç³–ç´ çš„ç·Šæ€¥ä½œç”¨
        GameState.bloodGlucose += 1.5; 
        displayMessage("ğŸ”” è¡€ç³–éä½ï¼èº«é«”è‡ªå‹•é‡‹æ”¾å‡ç³–ç´  (Glucagon) é€²è¡Œç·Šæ€¥æ•‘æ´ã€‚");
    }
    // ***************************************

    if (CORTISOL_AGENT.level > 30) {
        GameState.bloodGlucose += 1.0;
        displayMessage("ğŸš¨ çš®è³ªé†‡éé«˜ï¼Œé–‹å§‹ä¿ƒé€²ç³–è³ªæ–°ç”Ÿï¼Œè¡€ç³–æŒçºŒä¸Šå‡ï¼");
    }
}

function checkGameStatus() {
    const bg = GameState.bloodGlucose;
    const stress = GameState.stressLevel;
    const cortisol = CORTISOL_AGENT.level;
    const acth = ACTH_AGENT.level;
    
    // æ¢ä»¶ä¸€ï¼šå¤±æ•—æ¢ä»¶ (Fail Condition)
    if (bg > 280 || bg < 50 || stress > 90) {
        displayMessage("â˜ ï¸ **æ†å®šå´©æ½°ï¼å…§åˆ†æ³Œå¤±è¡¡å°è‡´ç³»çµ±åœæ­¢é‹ä½œã€‚**");
        clearInterval(gameInterval); 
        alert("éŠæˆ²å¤±æ•—ï¼è«‹é‡è¼‰é é¢å†è©¦ã€‚");
        return true;
    }

    // æ¢ä»¶äºŒï¼šå‹åˆ©æ¢ä»¶ (Success Condition) - ä½¿ç”¨ç¬¦åˆç”Ÿç†æ¨™æº–çš„ç¯„åœ
    const isStable = (
        bg >= GameState.BG_MIN && bg <= GameState.BG_MAX && 
        stress < GameState.STRESS_MAX && 
        cortisol < GameState.CORTISOL_MAX && 
        acth < GameState.ACTH_MAX
    );

    if (isStable) {
        GameState.successCounter++;
        displayMessage(`ğŸ‰ æ†å®šç‹€æ…‹ç©©å®šï¼æŒçºŒæ™‚é–“ï¼š${GameState.successCounter} / ${GameState.SUCCESS_TARGET} ç§’`);

        if (GameState.successCounter >= GameState.SUCCESS_TARGET) {
            displayMessage("ğŸ† **ä»»å‹™å®Œæˆï¼æ‚¨å·²å®Œç¾æŒæ¡è·çˆ¾è’™èª¿æ§çš„è—è¡“ã€‚**");
            clearInterval(gameInterval); 
            alert(`æ­å–œæ‚¨ï¼æˆåŠŸå°‡æ‰€æœ‰ç”Ÿç†æŒ‡æ¨™ç¶­æŒåœ¨å¥åº·ç¯„åœ ${GameState.SUCCESS_TARGET} ç§’ã€‚`);
            return true;
        }
    } else {
        // å¦‚æœå¤±è¡¡ï¼Œè¨ˆæ•¸å™¨æ­¸é›¶
        if (GameState.successCounter > 0) {
            displayMessage("âš ï¸ ç©©å®šç‹€æ…‹ä¸­æ–·ï¼æ†å®šè¨ˆæ•¸å™¨æ­¸é›¶ã€‚");
        }
        GameState.successCounter = 0;
    }
    
    return false;
}

function gameLoop() {
    handleHormoneDecay();
    handleInteractions();
    
    if (checkGameStatus()) {
        return; 
    }

    updateDisplay();
}

// å•Ÿå‹•éŠæˆ²
updateDisplay();
initializeTargetDisplay(); // ç¢ºä¿å‹åˆ©æ¨™æº–åœ¨ç¶²é è¼‰å…¥æ™‚é¡¯ç¤º
const gameInterval = setInterval(gameLoop, GameState.TIME_TICK_MS);

// åˆå§‹å£“åŠ›äº‹ä»¶
setTimeout(() => {
    GameState.stressLevel = 60;
    GameState.bloodGlucose = 200; 
    displayMessage("âš¡ **ç·Šæ€¥äº‹ä»¶ï¼šé€£çºŒç†¬å¤œä¸”é«˜ç³–é£²é£Ÿï¼Œæ†å®šç³»çµ±é€²å…¥ç´…è‰²è­¦æˆ’ï¼** è«‹ç«‹å³è¡Œå‹•ï¼");
}, 500);
</script>
</body>
</html>